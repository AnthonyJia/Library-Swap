{% extends "base.html" %}
{% block content %}
  <h2>Borrow Books</h2>
  <p>This page is for users who want to borrow books.</p>
  <div style="text-align: right; font-size: small; margin-bottom: 10px;">
    Logged in as: {{ request.user.email }}
  </div>

  <!-- Search form -->
  <form method="get" action="">
      <div class="input-group mb-3">
         <input type="text" name="q" value="{{ query }}" class="form-control" placeholder="Search by title, author, or genre">
         <button class="btn btn-outline-secondary" type="submit">Search</button>
      </div>
  </form>

  <!-- List of books -->
  <div class="book-list">
    {% for book in books %}
      <div class="book-item" style="margin-bottom:20px;">
        {% if book.image %}
          <img src="{{ book.image.url }}" alt="{{ book.title }}" style="max-width:200px;">
        {% endif %}
        <h3>{{ book.title }}</h3>
        <p><strong>Author:</strong> {{ book.author }}</p>
        <p><strong>Genre:</strong> {{ book.genre }}</p>
        <p>{{ book.description }}</p>
        <p>Uploaded by: {{ book.user.email }}</p>
        {% if book.is_available %}
          <a href="{% url 'borrow_book' book.id %}" class="btn btn-success">Borrow</a>
        {% else %}
          {% if book.borrowed_by == request.user %}
            <button class="btn btn-warning" disabled>You borrowed this</button>
          {% else %}
            <button class="btn btn-secondary" disabled>Borrowed</button>
          {% endif %}
        {% endif %}
      </div>
    {% empty %}
      <p>No books found.</p>
    {% endfor %}
  </div>
{% endblock %}